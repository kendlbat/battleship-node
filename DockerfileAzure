FROM node:lts-alpine
ENV NODE_ENV=production
# Get port from argument
ARG PORT=8080
ENV PORT=$PORT
ARG ADDRESS="0.0.0.0"
ENV ADDRESS=$ADDRESS
WORKDIR /usr/src/app
COPY . .
RUN chown -R node /usr/src/app
USER node
EXPOSE 80
EXPOSE 443
EXPOSE $PORT
RUN npm install --no-save greenlock-express
RUN npx greenlock init --config-dir /usr/src/app/greenlock.d --package greenlock-express --maintainer-email "ssl@kendlbat.dev" --agree-tos --community-member --staging
RUN npx greenlock add --subject battleship.kendlbat.dev --altnames battleship.kendlbat.dev
# CMD [ "node", "server.js" ]
CMD ["npm", "run", "ssl", "--", "--staging"]